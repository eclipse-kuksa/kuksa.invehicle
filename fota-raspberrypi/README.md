# FOTA Raspberry Pi

The fota scripts are used by the kuksa-appmanager to flash firmware images to the Raspberry Pi.
Details on the interaction with the appmanager can be found in [kuksa-appmanager/wiki/fota.md](https://github.com/eclipse/kuksa.invehicle/blob/master/kuksa-appmanager/wiki/fota.md).

### kuksa-firmware-flash
When called, expects one line of JSON via stdin, containing the firmware name, version and files.
Currently only one file is supported which must be a firmware OS image.

### kuksa-firmware-get-version
Expects a firmware name as argument and prints a version to stdout.
Currently the only supported firmware name is *osimage* (name of the software module in hawkbit).
For this it returns the version the version of the currently installed OS according to /etc/os-release.

## Preliminaries
The SD card has to have three partitions:

1. boot partition
2. rootfs partition A
3. rootfs partition B

Only one rootfs partitions is active at a time.
When a new firmware is flashed, it is flashed to the inactive partition and the bootloader configuration is updated to switch to the other partition.

The AGL image by default only contains two partitions, the third one has to be added manually to the SD card.

## Firmware OS image
The firmware has to consist of exactly one file.
It must be an image containing a boot partition and a rootfs partition.
Two file types are supported:

* uncompressed .img file
* compressed .xz file (highly recommended)

The images generated by the yocto build process for AGL can be used directly.

## Rollback functionality
Is under development

